<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koki App</title>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Basic styling for the app */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .menu-item {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        .menu-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 15px;
        }
        .menu-details {
            flex: 1;
        }
        .price {
            font-weight: bold;
            color: #2a6496;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
        }
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        .status-selesai {
            background-color: #d4edda;
            color: #155724;
        }
        .status-dibatalkan {
            background-color: #f8d7da;
            color: #721c24;
        }
        .order-card {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .order-items {
            margin-top: 10px;
        }
        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .chef-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Koki App</h1>

        <!-- Menu Section -->
        <div class="card">
            <h2>Menu</h2>
            <div id="menu-items"></div>
        </div>

        <!-- Orders Section -->
        <div class="card">
            <h2>Pesanan</h2>
            <div id="orders"></div>
        </div>
    </div>

    <script>
        // Configuration
        const supabaseUrl = 'https://tjojpjcgwnkklocanuqt.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRqb2pwamNnd25ra2xvY2FudXF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4MzQwNDUsImV4cCI6MjA3OTQxMDA0NX0.JqlGuZG0wu23ySjA1yOXbE7L_mHh3qUspqhtHJ_Mlmw';

        // Mock Data
        const MOCK_MENU_ITEMS = [
            { name: "Nasi Goreng Spesial", price: 18000, category: "makanan", image: "https://bing.com/th?id=OSK.05368722ca716fa5bdff5caa636e453f", description: "Nasi goreng dengan telur." },
            { name: "Mie Ayam Bakso", price: 15000, category: "makanan", image: "https://static.vecteezy.com/system/resources/previews/015/958/027/non_2x/mie-ayam-or-noodles-chicken-is-traditional-food-from-indonesia-asia-made-from-noodle-chicken-chicken-broth-spinach-sometimes-with-meatball-photo.jpg", description: "Mie ayam kenyal." },
            { name: "Ayam Geprek Sambal Bawang", price: 20000, category: "makanan", image: "https://img-global.cpcdn.com/recipes/ae5a1335a284b9e9/680x482cq70/255-ayam-geprek-sambal-bawang-foto-resep-utama.jpg", description: "Pedas nampol." },
            { name: "Es Teh Manis Jumbo", price: 5000, category: "minuman", image: "https://images.unsplash.com/photo-1556679343-c7306c1976bc", description: "Segar dan manis." },
            { name: "Kopi Susu Gula Aren", price: 12000, category: "minuman", image: "https://images.unsplash.com/photo-1541167760496-1628856ab772", description: "Kopi kekinian." }
        ];

        const SAMPLE_ORDERS_DATA = [
            {
                customer_name: 'Budi Santoso',
                customer_role: 'siswa',
                total_price: 23000,
                status: 'selesai',
                created_at: new Date(Date.now() - 86400000 * 2).toISOString(),
                items: [
                    { menu_name: 'Nasi Goreng Spesial', quantity: 1, price_at_purchase: 18000 },
                    { menu_name: 'Es Teh Manis Jumbo', quantity: 1, price_at_purchase: 5000 }
                ]
            },
            {
                customer_name: 'Siti Aminah',
                customer_role: 'tamu',
                customer_phone: '081234567890',
                total_price: 40000,
                status: 'pending',
                created_at: new Date(Date.now() - 3600000 * 4).toISOString(),
                items: [
                    { menu_name: 'Ayam Geprek Sambal Bawang', quantity: 2, price_at_purchase: 20000 }
                ]
            },
            {
                customer_name: 'Andi Pratama',
                customer_role: 'siswa',
                total_price: 18000,
                status: 'selesai',
                created_at: new Date(Date.now() - 86400000 * 1).toISOString(),
                items: [
                    { menu_name: 'Nasi Goreng Spesial', quantity: 1, price_at_purchase: 18000 }
                ]
            },
            {
                customer_name: 'Pak Guru Budi',
                customer_role: 'admin',
                total_price: 30000,
                status: 'selesai',
                created_at: new Date(Date.now() - 3600000 * 2).toISOString(),
                items: [
                    { menu_name: 'Mie Ayam Bakso', quantity: 2, price_at_purchase: 15000 }
                ]
            },
            {
                customer_name: 'Rina Wati',
                customer_role: 'tamu',
                customer_phone: '089876543210',
                total_price: 25000,
                status: 'dibatalkan',
                created_at: new Date(Date.now() - 1800000).toISOString(),
                items: [
                    { menu_name: 'Ayam Geprek Sambal Bawang', quantity: 1, price_at_purchase: 20000 },
                    { menu_name: 'Es Teh Manis Jumbo', quantity: 1, price_at_purchase: 5000 }
                ]
            },
        ];

        // Helper Functions
        const supabaseRequest = async (endpoint, method = 'GET', body = null) => {
            const headers = {
                'apikey': supabaseKey,
                'Authorization': `Bearer ${supabaseKey}`,
                'Content-Type': 'application/json',
                'Prefer': 'return=representation'
            };
            const options = { method, headers, body: body ? JSON.stringify(body) : null };
            const response = await fetch(`${supabaseUrl}/rest/v1/${endpoint}`, options);
            if (response.status === 404) throw new Error('Table not found');
            if (!response.ok) {
                const err = await response.json();
                throw new Error(err.message || 'Request failed');
            }
            return response.json();
        };

        const formatRupiah = (number) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);

        // Render Functions
        const renderMenuItems = (items) => {
            const menuContainer = document.getElementById('menu-items');
            menuContainer.innerHTML = '';

            items.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.className = 'menu-item';

                menuItem.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="menu-image">
                    <div class="menu-details">
                        <h3>${item.name}</h3>
                        <p>${item.description}</p>
                        <p class="price">${formatRupiah(item.price)}</p>
                        <p>Kategori: ${item.category}</p>
                    </div>
                `;

                menuContainer.appendChild(menuItem);
            });
        };

        const renderOrders = (orders) => {
            const ordersContainer = document.getElementById('orders');
            ordersContainer.innerHTML = '';

            orders.forEach(order => {
                const orderCard = document.createElement('div');
                orderCard.className = 'order-card';

                const statusClass = `status-${order.status.replace(' ', '-')}`;

                orderCard.innerHTML = `
                    <div class="order-header">
                        <div>
                            <h3>${order.customer_name}</h3>
                            <p>${order.customer_role}${order.customer_phone ? ` - ${order.customer_phone}` : ''}</p>
                            <p>${new Date(order.created_at).toLocaleString('id-ID')}</p>
                        </div>
                        <div>
                            <span class="status ${statusClass}">${order.status}</span>
                            <p class="price">${formatRupiah(order.total_price)}</p>
                        </div>
                    </div>
                    <div class="order-items">
                        ${order.items.map(item => `
                            <div class="order-item">
                                <span>${item.menu_name} x ${item.quantity}</span>
                                <span>${formatRupiah(item.price_at_purchase * item.quantity)}</span>
                            </div>
                        `).join('')}
                    </div>
                `;

                ordersContainer.appendChild(orderCard);
            });
        };

        // Initialize the app
        const initApp = async () => {
            try {
                // Try to fetch data from Supabase
                const menuItems = await supabaseRequest('menu_items');
                const orders = await supabaseRequest('orders');

                // If successful, use the fetched data
                renderMenuItems(menuItems.length > 0 ? menuItems : MOCK_MENU_ITEMS);
                renderOrders(orders.length > 0 ? orders : SAMPLE_ORDERS_DATA);
            } catch (error) {
                console.error('Error fetching data from Supabase:', error);
                // Fall back to mock data if there's an error
                renderMenuItems(MOCK_MENU_ITEMS);
                renderOrders(SAMPLE_ORDERS_DATA);
            }
        };

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
