<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kantin Digital App - HTML/JS</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    keyframes: {
                        'fade-in-up': {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        'slide-in-right': {
                            '0%': { transform: 'translateX(100%)' },
                            '100%': { transform: 'translateX(0)' },
                        }
                    },
                    animation: {
                        'fade-in-up': 'fade-in-up 0.5s ease-out',
                        'slide-in-right': 'slide-in-right 0.3s ease-out',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom CSS for visual polish and scrollbar hiding */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        /* Ensures the cart sidebar animation works correctly */
        .slide-in-right {
            animation: slide-in-right 0.3s forwards;
        }

        /* Reusable SVG Icon Styles */
        .icon {
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body class="font-sans text-gray-800 bg-gray-50 antialiased" id="app-root">

    <!-- The entire application will be rendered inside this div by JavaScript -->

    <script>
        // --- 1. Data Mock Menu ---
        const MENU_ITEMS = [
            {
                id: 1,
                name: "Nasi Goreng Spesial",
                price: 18000,
                category: "makanan",
                image: "https://bing.com/th?id=OSK.05368722ca716fa5bdff5caa636e453f",
                desc: "Nasi goreng dengan telur, ayam suwir, dan kerupuk."
            },
            {
                id: 2,
                name: "Mie Ayam Bakso",
                price: 15000,
                category: "makanan",
                image: "https://static.vecteezy.com/system/resources/previews/015/958/027/non_2x/mie-ayam-or-noodles-chicken-is-traditional-food-from-indonesia-asia-made-from-noodle-chicken-chicken-broth-spinach-sometimes-with-meatball-photo.jpg",
                desc: "Mie ayam kenyal dengan topping ayam kecap dan bakso sapi."
            },
            {
                id: 3,
                name: "Ayam Geprek Sambal Bawang",
                price: 20000,
                category: "makanan",
                image: "https://img-global.cpcdn.com/recipes/ae5a1335a284b9e9/680x482cq70/255-ayam-geprek-sambal-bawang-foto-resep-utama.jpg",
                desc: "Ayam goreng tepung crispy digeprek dengan sambal bawang pedas."
            },
            {
                id: 4,
                name: "Soto Ayam Lamongan",
                price: 17000,
                category: "makanan",
                image: "https://images.unsplash.com/photo-1572656631137-7935297eff55?auto=format&fit=crop&q=100&w=1000",
                desc: "Kuah kuning segar dengan koya gurih dan irisan ayam."
            },
            {
                id: 5,
                name: "Es Teh Manis Jumbo",
                price: 5000,
                category: "minuman",
                image: "https://images.unsplash.com/photo-1556679343-c7306c1976bc?auto=format&fit=crop&q=100&w=1000",
                desc: "Teh manis dingin ukuran jumbo segar."
            },
            {
                id: 6,
                name: "Es Jeruk Peras",
                price: 7000,
                category: "minuman",
                image: "https://images.unsplash.com/photo-1613478223719-2ab802602423?auto=format&fit=crop&q=100&w=1000",
                desc: "Jeruk peras murni dengan es batu."
            },
            {
                id: 7,
                name: "Kopi Susu Gula Aren",
                price: 12000,
                category: "minuman",
                image: "https://images.unsplash.com/photo-1541167760496-1628856ab772?auto=format&fit=crop&q=100&w=1000",
                desc: "Kopi susu kekinian dengan gula aren asli."
            },
            {
                id: 8,
                name: "Dimsum Ayam (4 pcs)",
                price: 13000,
                category: "makanan",
                image: "https://cdn.idntimes.com/content-images/community/2021/12/265577571-2079294085561407-2876930124273163698-n-2-4e99c9153ffc58bc10ca9cd5bdccf58e-081fa7bb4af405ff72480b176fc0315b.jpg",
                desc: "Dimsum hangat dengan saus pedas manis."
            },
        ];

        // --- 2. State Management (Global Variables) ---
        let state = {
            isLoggedIn: false,
            loginForm: { username: '', password: '' },
            loginRole: 'siswa', // 'siswa' | 'admin' | 'tamu'
            loginError: '',
            cart: [],
            isCartOpen: false,
            selectedCategory: 'all',
            searchQuery: '',
            showSuccessMsg: false,
            isOrderConfirmed: false,
        };

        const bgCanteenUrl = "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?q=100&w=3000&auto=format&fit=crop";

        // --- 3. Utility Functions ---
        const formatRupiah = (number) => {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0,
            }).format(number);
        };

        // Simplified SVG icons (mimicking Lucide for UI)
        const Icons = {
            ShoppingCart: (size = 24, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 12.08a2 2 0 0 0 2 1.92h11.44a2 2 0 0 0 2-1.92L23 6H6"/></svg>`,
            Search: (size = 20, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>`,
            Plus: (size = 20, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>`,
            Minus: (size = 14, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><line x1="5" y1="12" x2="19" y2="12"/></svg>`,
            Trash2: (size = 18, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/></svg>`,
            Utensils: (size = 16, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M3 22h18M15 22V2h4l4 4V22z"/></svg>`,
            Coffee: (size = 16, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><path d="M10 2a7 7 0 0 0-7 7v10a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3V9a7 7 0 0 0-7-7z"/><path d="M8 7h8"/><path d="M17 11h-2a4 4 0 0 0-4 4v4a4 4 0 0 0 4 4h2"/></svg>`,
            X: (size = 16, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`,
            User: (size = 18, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`,
            Lock: (size = 18, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>`,
            ArrowRight: (size = 18, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>`,
            LogOut: (size = 20, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>`,
            GraduationCap: (size = 16, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><path d="M21.42 10.98V19H12a2 2 0 0 1-2-2v-6.02L21.42 10.98z"/><path d="M8 2.02L21.42 10.98"/><path d="M10 17V7.82"/><path d="M4 17V7.82"/><path d="M4 17a2 2 0 0 0 2 2h14"/></svg>`,
            ShieldCheck: (size = 16, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M9 12l2 2 4-4"/></svg>`,
            UserCircle: (size = 16, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662"/></svg>`,
            ChefHat: (size = 16, className = "") => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon ${className}"><path d="M17 21h-2a4 4 0 0 1-4-4V5h4a2 2 0 0 0 2-2V2a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1v1a2 2 0 0 0 2 2h4v12a4 4 0 0 1-4 4H3"/></svg>`,
        };
        
        // --- 4. Logic Functions (State Mutators) ---
        
        const updateState = (newState) => {
            state = { ...state, ...newState };
            renderApp();
        };

        const handleLogin = (e) => {
            e.preventDefault();
            const { username, password } = state.loginForm;
            const role = state.loginRole;
            
            let loginError = '';

            if (!username) {
                loginError = 'Nama/Username wajib diisi!';
            } else if (role !== 'tamu' && !password) {
                loginError = 'Password wajib diisi!';
            }

            if (loginError) {
                updateState({ loginError: loginError });
                return;
            }

            // Successful login simulation
            updateState({ isLoggedIn: true, loginError: '' });
        };

        const handleLogout = () => {
            updateState({
                isLoggedIn: false,
                cart: [],
                loginForm: { username: '', password: '' },
                loginRole: 'siswa',
                isOrderConfirmed: false,
                isCartOpen: false,
                searchQuery: '',
                selectedCategory: 'all',
            });
        };

        const addToCart = (itemId) => {
            const item = MENU_ITEMS.find(i => i.id === itemId);
            if (!item) return;

            let newCart;
            const existing = state.cart.find((i) => i.id === itemId);

            if (existing) {
                newCart = state.cart.map((i) =>
                    i.id === itemId ? { ...i, quantity: i.quantity + 1 } : i
                );
            } else {
                newCart = [...state.cart, { ...item, quantity: 1 }];
            }

            updateState({ cart: newCart, showSuccessMsg: true });
            
            setTimeout(() => {
                updateState({ showSuccessMsg: false });
            }, 2000);
        };

        const removeFromCart = (itemId) => {
            const newCart = state.cart.filter((item) => item.id !== itemId);
            updateState({ cart: newCart });
        };

        const updateQuantity = (itemId, delta) => {
            const newCart = state.cart.map((item) => {
                if (item.id === itemId) {
                    const newQty = item.quantity + delta;
                    return newQty > 0 ? { ...item, quantity: newQty } : item;
                }
                return item;
            }).filter(item => item.quantity > 0); // Remove if quantity drops to 0

            updateState({ cart: newCart });
        };

        const handleCheckout = () => {
            if (state.cart.length === 0) return;
            updateState({ isOrderConfirmed: true, isCartOpen: false });
        };

        const handleNewOrder = () => {
            updateState({
                cart: [],
                isOrderConfirmed: false,
                searchQuery: '',
                selectedCategory: 'all',
            });
        };

        // --- 5. HTML Templates and Rendering ---

        const getCartTotals = () => {
            const totalItems = state.cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = state.cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            return { totalItems, totalPrice };
        };

        const ChefLogo = (className, size) => {
            const logoUrl = "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiIZNm0p847w_vzBhFL27maZYPzhhrG0oIt9J-veBYqxKabDiO1k5VjChDKqTYdCE6soM-VFcUzJgUxMZqYwyo3jpU79PkX04ZIioF82kYDcRK9-ph6-dTXdIh1rwW5Od0WG_96oYj_lHfZ0bepe98XYdb-w5IkQZ964Xeq2Qve8lMG44-ZhaP3fd6dd1Q/s320/WhatsApp%20Image%202025-11-21%20at%2016.41.08.jpeg";
            const w_h = size || 'w-24 h-24';

            return `
                <div class="relative overflow-hidden rounded-full border-2 border-white shadow-md ${w_h} ${className}">
                    <img 
                        src="${logoUrl}" 
                        alt="Logo Kantin Digital"
                        class="w-full h-full object-cover"
                        onerror="this.onerror=null; this.src='https://placehold.co/320x320/FF6347/FFFFFF?text=CHEF';"
                    />
                </div>
            `;
        };

        const renderLogin = () => {
            const { loginForm, loginRole, loginError } = state;

            return `
                <div 
                    class="min-h-screen flex items-center justify-center p-4 relative overflow-hidden bg-cover bg-center"
                    style="background-image: url(${bgCanteenUrl})"
                >
                    <!-- Overlay Gelap -->
                    <div class="absolute inset-0 bg-black/50"></div>

                    <div class="bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl p-8 w-full max-w-md z-10 animate-fade-in-up transition-all border border-white/20">
                        <div class="text-center mb-6">
                            <div class="mx-auto mb-4 w-24 h-24 flex items-center justify-center">
                                ${ChefLogo('shadow-lg shadow-red-600/30', 'w-24 h-24')}
                            </div>
                            <h1 class="text-2xl font-bold text-gray-800">Kantin Digital</h1>
                            <p class="text-gray-500 text-sm mt-1 font-medium">Kantinnya Anak Sekolah! Menu Enak, Harga Bersahabat üöÄ</p>
                        </div>

                        <!-- Role Selector Tabs -->
                        <div class="flex bg-gray-100 p-1 rounded-xl mb-6">
                            ${['siswa', 'admin', 'tamu'].map(role => `
                                <button
                                    type="button"
                                    onclick="updateState({ loginRole: '${role}', loginError: '' })"
                                    class="flex-1 flex items-center justify-center gap-2 py-2 text-sm font-medium rounded-lg transition-all ${
                                        loginRole === role ? 'bg-white text-red-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'
                                    }"
                                >
                                    ${role === 'siswa' ? Icons.GraduationCap(16) : role === 'admin' ? Icons.ShieldCheck(16) : Icons.UserCircle(16)} ${role.charAt(0).toUpperCase() + role.slice(1)}
                                </button>
                            `).join('')}
                        </div>

                        <form onsubmit="handleLogin(event)" class="space-y-5">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    ${loginRole === 'siswa' ? 'NIS / Nama Siswa' : loginRole === 'admin' ? 'Username Admin' : 'Nama Lengkap'}
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        ${Icons.User(18, 'text-gray-400')}
                                    </div>
                                    <input
                                        type="text"
                                        required
                                        class="pl-10 block w-full border-gray-300 rounded-lg border p-2.5 focus:ring-red-500 focus:border-red-500 transition-colors"
                                        placeholder="${loginRole === 'tamu' ? 'Masukkan nama Anda' : 'Masukkan ID pengguna'}"
                                        value="${loginForm.username}"
                                        oninput="state.loginForm.username = this.value; renderApp();"
                                    />
                                </div>
                            </div>

                            <!-- Password Field - Hidden for Tamu -->
                            ${loginRole !== 'tamu' ? `
                                <div class="animate-fade-in-up">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            ${Icons.Lock(18, 'text-gray-400')}
                                        </div>
                                        <input
                                            type="password"
                                            required
                                            class="pl-10 block w-full border-gray-300 rounded-lg border p-2.5 focus:ring-red-500 focus:border-red-500 transition-colors"
                                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                            value="${loginForm.password}"
                                            oninput="state.loginForm.password = this.value; renderApp();"
                                        />
                                    </div>
                                </div>
                            ` : ''}

                            ${loginError ? `
                                <div class="bg-red-50 text-red-600 text-sm p-3 rounded-lg flex items-center gap-2 animate-pulse">
                                    ${Icons.X(16)} ${loginError}
                                </div>
                            ` : ''}

                            <button
                                type="submit"
                                class="w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-bold py-3 rounded-lg shadow-lg transform transition-all active:scale-95 flex items-center justify-center gap-2"
                            >
                                ${loginRole === 'tamu' ? 'Masuk Sebagai Tamu' : 'Masuk Sekarang'} ${Icons.ArrowRight(18)}
                            </button>
                        </form>
                        
                        <div class="mt-6 text-center text-xs text-gray-500 font-medium">
                            &copy; 2025 Kantin Digital App by Anzilah Nurcahaya
                        </div>
                    </div>
                </div>
            `;
        };

        const renderAppMain = () => {
            const { loginForm, loginRole, cart, selectedCategory, searchQuery, isOrderConfirmed, showSuccessMsg } = state;
            const { totalItems, totalPrice } = getCartTotals();
            
            // Logic Filter
            const filteredItems = MENU_ITEMS.filter((item) => {
                const matchCategory = selectedCategory === 'all' || item.category === selectedCategory;
                const matchSearch = item.name.toLowerCase().includes(searchQuery.toLowerCase());
                return matchCategory && matchSearch;
            });

            return `
                <div class="min-h-screen bg-gray-50 font-sans text-gray-800">
                    
                    <!-- --- Header / Navbar --- -->
                    <nav class="sticky top-0 z-40 bg-white/90 backdrop-blur-md shadow-sm border-b border-gray-100">
                        <div class="max-w-5xl mx-auto px-4 py-3 flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                ${ChefLogo('shadow-red-500/20', 'w-10 h-10')}
                                <div>
                                    <h1 class="text-xl font-bold text-gray-900 leading-none tracking-tight">Kantin Digital</h1>
                                    <div class="flex items-center gap-1 text-xs text-gray-500 mt-0.5">
                                        <span>Halo,</span>
                                        <span class="font-bold text-red-600 max-w-[100px] truncate">${loginForm.username}</span>
                                        <span class="bg-gray-100 px-1.5 py-0.5 rounded text-[10px] font-medium uppercase tracking-wide text-gray-600 border border-gray-200">
                                            ${loginRole}
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="flex items-center gap-3">
                                <button
                                    onclick="handleLogout()"
                                    class="p-2 hover:bg-red-50 text-gray-500 hover:text-red-600 rounded-full transition-colors"
                                    title="Keluar"
                                >
                                    ${Icons.LogOut(20)}
                                </button>
                                <button
                                    onclick="updateState({ isCartOpen: true })"
                                    class="relative p-2 hover:bg-gray-100 rounded-full transition-colors"
                                >
                                    ${Icons.ShoppingCart(24, 'text-gray-700')}
                                    ${totalItems > 0 && !isOrderConfirmed ? `
                                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full animate-bounce shadow-sm">
                                            ${totalItems}
                                        </span>
                                    ` : ''}
                                </button>
                            </div>
                        </div>
                    </nav>

                    <!-- --- Hero Section with Background --- -->
                    ${!isOrderConfirmed ? `
                        <div
                            class="relative bg-gray-900 text-white py-12 px-4 mb-8 overflow-hidden"
                        >
                            <!-- Background Image & Overlay -->
                            <div
                                class="absolute inset-0 bg-cover bg-center opacity-60"
                                style="background-image: url(${bgCanteenUrl})"
                            ></div>
                            <div class="absolute inset-0 bg-gradient-to-r from-red-900/80 to-black/40"></div>

                            <div class="relative max-w-5xl mx-auto z-10">
                                <h2 class="text-3xl md:text-4xl font-bold mb-2 drop-shadow-md">
                                    ${loginRole === 'admin' ? 'Selamat Datang Admin!' : 'Mau makan apa hari ini?'}
                                </h2>
                                <p class="opacity-100 mb-6 text-lg text-gray-100 max-w-2xl drop-shadow-md font-medium">
                                    ${loginRole === 'admin'
                                        ? 'Kelola pesanan dan menu kantin dengan mudah dan efisien.'
                                        : 'Nikmati hidangan lezat kantin sekolah, pesan langsung dari tempat dudukmu tanpa antri.'}
                                </p>
                                
                                <!-- Search Bar -->
                                <div class="relative max-w-lg">
                                    <input
                                        type="text"
                                        placeholder="Cari menu favoritmu..."
                                        class="w-full pl-10 pr-4 py-3.5 rounded-xl text-gray-800 focus:outline-none focus:ring-4 focus:ring-red-500/30 shadow-xl transition-all"
                                        value="${searchQuery}"
                                        oninput="updateState({ searchQuery: this.value })"
                                    />
                                    ${Icons.Search(20, 'absolute left-3 top-4 text-gray-400')}
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <!-- --- Main Content: Menu or Order Confirmation --- -->
                    ${isOrderConfirmed ? renderOrderConfirmation() : renderMenu(filteredItems)}

                    <!-- --- Toast Notifikasi --- -->
                    ${showSuccessMsg ? `
                        <div class="fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full shadow-xl z-50 text-sm flex items-center gap-3 animate-fade-in-up ring-1 ring-white/20">
                            <div class="bg-green-500 rounded-full p-0.5">${Icons.ShieldCheck(14, 'text-white')}</div>
                            <span>Berhasil ditambahkan ke keranjang!</span>
                        </div>
                    ` : ''}

                    <!-- --- Floating Action Button (Mobile) --- -->
                    ${!isOrderConfirmed ? `
                        <div class="fixed bottom-6 right-6 md:hidden z-30">
                            <button
                                onclick="updateState({ isCartOpen: true })"
                                class="bg-gradient-to-br from-red-600 to-red-700 text-white p-4 rounded-full shadow-2xl shadow-red-600/30 flex items-center justify-center relative active:scale-90 transition-transform"
                            >
                                ${Icons.ShoppingCart(24)}
                                ${totalItems > 0 ? `
                                    <span class="absolute -top-1 -right-1 bg-white text-red-600 text-xs font-extrabold w-6 h-6 flex items-center justify-center rounded-full border-2 border-red-600">
                                        ${totalItems}
                                    </span>
                                ` : ''}
                            </button>
                        </div>
                    ` : ''}

                    <!-- --- Cart Sidebar / Modal --- -->
                    ${state.isCartOpen ? renderCartSidebar(totalItems, totalPrice) : ''}
                </div>
            `;
        };

        const renderMenu = (filteredItems) => {
            const { selectedCategory } = state;
            return `
                <main class="max-w-5xl mx-auto px-4 pb-24">
                    
                    <!-- --- Kategori --- -->
                    <div class="flex gap-3 overflow-x-auto pb-4 mb-6 scrollbar-hide">
                        ${[
                            { id: 'all', label: 'Semua', icon: Icons.Utensils(16) },
                            { id: 'makanan', label: 'Makanan', icon: Icons.ChefHat(16) },
                            { id: 'minuman', label: 'Minuman', icon: Icons.Coffee(16) },
                        ].map((cat) => `
                            <button
                                onclick="updateState({ selectedCategory: '${cat.id}' })"
                                class="group flex items-center gap-2 px-6 py-2.5 rounded-full whitespace-nowrap transition-all font-medium text-sm ${
                                    selectedCategory === cat.id
                                        ? 'bg-red-600 text-white shadow-lg shadow-red-600/20 transform scale-105'
                                        : 'bg-white text-gray-600 border border-gray-200 hover:bg-red-50 hover:border-red-300'
                                }"
                            >
                                ${cat.icon.replace('currentColor', selectedCategory === cat.id ? 'white' : 'currentColor').replace('class="icon', `class="icon ${selectedCategory === cat.id ? '' : 'text-gray-600 group-hover:text-red-600'}`)}
                                <span class="">${cat.label}</span>
                            </button>
                        `).join('')}
                    </div>

                    <!-- --- Grid Menu --- -->
                    ${filteredItems.length > 0 ? `
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5">
                            ${filteredItems.map((item) => `
                                <div class="group bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-1 flex flex-col">
                                    <div class="relative h-44 w-full bg-gray-200 overflow-hidden">
                                        <img
                                            src="${item.image}"
                                            alt="${item.name}"
                                            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                                            onerror="this.onerror=null; this.src='https://placehold.co/400x400/FF6347/FFFFFF?text=MENU';"
                                        />
                                        <div class="absolute top-3 right-3 bg-white/95 backdrop-blur-sm px-2.5 py-1 rounded-lg text-xs font-bold shadow-sm flex items-center gap-1">
                                            ${item.category === 'makanan' ? 'üçî' : 'ü•§'}
                                        </div>
                                    </div>
                                    
                                    <div class="p-4 flex flex-col flex-grow">
                                        <h3 class="font-bold text-gray-800 mb-1 line-clamp-1 text-base group-hover:text-red-600 transition-colors">${item.name}</h3>
                                        <p class="text-xs text-gray-500 mb-4 line-clamp-2 leading-relaxed">${item.desc}</p>
                                        
                                        <div class="mt-auto flex items-center justify-between">
                                            <span class="font-bold text-red-600 text-lg">${formatRupiah(item.price)}</span>
                                            <button
                                                onclick="addToCart(${item.id})"
                                                class="bg-red-50 text-red-600 p-2.5 rounded-xl hover:bg-red-600 hover:text-white active:scale-90 transition-all shadow-sm"
                                            >
                                                ${Icons.Plus(20)}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="text-center py-24 text-gray-400 bg-white rounded-2xl border border-dashed border-gray-200">
                            ${Icons.Utensils(64, 'mx-auto mb-4 opacity-20')}
                            <p class="text-lg font-medium">Menu tidak ditemukan.</p>
                            <p class="text-sm">Coba cari dengan kata kunci lain.</p>
                        </div>
                    `}
                </main>
            `;
        };

        const renderOrderConfirmation = () => {
            const { loginForm, loginRole, cart } = state;
            const { totalPrice } = getCartTotals();
            const orderNumber = `KD${Date.now().toString().slice(-6)}`;

            return `
                <div class="max-w-2xl mx-auto px-4 pb-24 animate-fade-in-up">
                    <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-8 md:p-10">
                        <div class="text-center mb-8">
                            ${Icons.ChefHat(48, 'mx-auto text-red-600 mb-3')}
                            <h2 class="text-3xl font-extrabold text-gray-900">Pesanan Berhasil!</h2>
                            <p class="text-gray-500 mt-1">Pesanan Anda telah dikonfirmasi. Tunjukkan struk ini di kasir.</p>
                        </div>

                        <div class="border-t border-b border-dashed border-gray-300 py-4 mb-6">
                            <div class="flex justify-between text-sm text-gray-700 mb-1">
                                <span>Pelanggan</span>
                                <span class="font-semibold">${loginForm.username} (${loginRole})</span>
                            </div>
                            <div class="flex justify-between text-sm text-gray-700">
                                <span>No. Order</span>
                                <span class="font-semibold">#${orderNumber}</span>
                            </div>
                        </div>

                        <h3 class="text-xl font-bold text-gray-800 mb-4">Detail Pesanan</h3>
                        <ul class="space-y-3 mb-6">
                            ${cart.map((item) => `
                                <li class="flex justify-between items-center text-gray-700 border-b border-gray-100 pb-2">
                                    <span class="text-sm">
                                        ${item.name} <span class="text-red-500 font-medium">(${item.quantity}x)</span>
                                    </span>
                                    <span class="font-semibold">${formatRupiah(item.price * item.quantity)}</span>
                                </li>
                            `).join('')}
                        </ul>

                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex justify-between items-center text-2xl font-extrabold text-gray-900">
                                <span>TOTAL BAYAR</span>
                                <span class="text-red-700">${formatRupiah(totalPrice)}</span>
                            </div>
                        </div>
                    </div>

                    <p class="text-center text-sm text-gray-500 mt-4 font-medium">
                        *Pesanan akan diproses setelah pembayaran di kasir.
                    </p>

                    <button
                        onclick="handleNewOrder()"
                        class="w-full mt-6 bg-red-600 text-white font-bold py-3 rounded-xl hover:bg-red-700 transition-colors active:scale-95 shadow-lg flex items-center justify-center gap-2"
                    >
                        ${Icons.ArrowRight(20)} Pesan Lagi (Buat Order Baru)
                    </button>
                </div>
            `;
        };

        const renderCartSidebar = (totalItems, totalPrice) => {
            const { cart } = state;

            return `
                <div class="fixed inset-0 z-50 flex justify-end">
                    <!-- Backdrop -->
                    <div
                        class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity"
                        onclick="updateState({ isCartOpen: false })"
                    ></div>

                    <!-- Sidebar Content -->
                    <div class="relative w-full max-w-md bg-white h-full shadow-2xl flex flex-col slide-in-right">
                        <div class="p-5 border-b border-gray-100 flex items-center justify-between bg-white">
                            <h2 class="text-xl font-bold flex items-center gap-3">
                                ${Icons.ShoppingCart(24, 'text-red-600')}
                                Keranjang Pesanan
                            </h2>
                            <button
                                onclick="updateState({ isCartOpen: false })"
                                class="p-2 hover:bg-gray-100 rounded-full transition-colors text-gray-400 hover:text-gray-800"
                            >
                                ${Icons.X(24)}
                            </button>
                        </div>

                        <div class="flex-1 overflow-y-auto p-5 space-y-4 bg-gray-50/50">
                            ${cart.length === 0 ? `
                                <div class="h-full flex flex-col items-center justify-center text-gray-400 space-y-6">
                                    <div class="bg-white p-8 rounded-full shadow-sm border border-gray-100">
                                        ${Icons.ShoppingCart(64, 'opacity-30 text-gray-400')}
                                    </div>
                                    <div class="text-center">
                                        <p class="text-lg font-semibold text-gray-600">Keranjang Kosong</p>
                                        <p class="text-sm mt-1">Kamu belum memilih menu apapun.</p>
                                    </div>
                                    <button
                                        onclick="updateState({ isCartOpen: false })"
                                        class="text-red-600 font-bold hover:underline hover:text-red-700 transition-colors"
                                    >
                                        Mulai Pesan Sekarang
                                    </button>
                                </div>
                            ` : `
                                ${cart.map((item) => `
                                    <div class="flex gap-4 bg-white p-3 rounded-2xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                                        <img
                                            src="${item.image}"
                                            alt="${item.name}"
                                            class="w-20 h-20 rounded-xl object-cover"
                                            onerror="this.onerror=null; this.src='https://placehold.co/80x80/FF6347/FFFFFF?text=MENU';"
                                        />
                                        <div class="flex-1 flex flex-col justify-between py-0.5">
                                            <div>
                                                <h4 class="font-bold text-gray-800 text-sm line-clamp-1">${item.name}</h4>
                                                <p class="text-red-600 font-bold text-sm mt-1">${formatRupiah(item.price)}</p>
                                            </div>
                                            
                                            <div class="flex items-center justify-between mt-2">
                                                <div class="flex items-center gap-3 bg-gray-50 rounded-lg p-1 border border-gray-100">
                                                    <button
                                                        onclick="updateQuantity(${item.id}, -1)"
                                                        class="w-7 h-7 flex items-center justify-center hover:bg-white rounded-md shadow-sm transition-all text-gray-600"
                                                    >
                                                        ${Icons.Minus(14)}
                                                    </button>
                                                    <span class="text-sm font-bold w-4 text-center">${item.quantity}</span>
                                                    <button
                                                        onclick="updateQuantity(${item.id}, 1)"
                                                        class="w-7 h-7 flex items-center justify-center hover:bg-white rounded-md shadow-sm transition-all text-gray-600"
                                                    >
                                                        ${Icons.Plus(14)}
                                                    </button>
                                                </div>
                                                <button
                                                    onclick="removeFromCart(${item.id})"
                                                    class="text-gray-400 hover:text-red-500 p-2 hover:bg-red-50 rounded-lg transition-colors"
                                                >
                                                    ${Icons.Trash2(18)}
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            `}
                        </div>

                        <!-- Footer Cart -->
                        ${cart.length > 0 ? `
                            <div class="p-5 border-t border-gray-100 bg-white shadow-[0_-4px_20px_rgba(0,0,0,0.05)]">
                                <div class="flex justify-between items-center mb-4">
                                    <span class="text-sm font-medium text-gray-600">Total Pesanan (${totalItems} item)</span>
                                    <span class="text-xl font-bold text-red-700">${formatRupiah(totalPrice)}</span>
                                </div>
                                
                                <button
                                    onclick="handleCheckout()"
                                    class="w-full bg-red-600 text-white font-bold py-3 rounded-xl hover:bg-red-700 transition-colors active:scale-95 shadow-lg flex items-center justify-center gap-2"
                                >
                                    ${Icons.ShieldCheck(20)} Konfirmasi Pesanan
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        };

        const renderApp = () => {
            const root = document.getElementById('app-root');
            if (state.isLoggedIn) {
                root.innerHTML = renderAppMain();
            } else {
                root.innerHTML = renderLogin();
            }

            // Re-bind event handlers that were lost after innerHTML update (e.g., in login form)
            if (!state.isLoggedIn) {
                const loginFormEl = document.querySelector('form');
                if (loginFormEl) {
                    loginFormEl.onsubmit = handleLogin;

                    // Bind input changes to state/render for password/username
                    document.querySelectorAll('input[type="text"], input[type="password"]').forEach(input => {
                        input.oninput = function() {
                            const field = this.getAttribute('placeholder').includes('ID') || this.getAttribute('placeholder').includes('nama') ? 'username' : 'password';
                            state.loginForm[field] = this.value;
                            // Only re-render when changing roles, not for every keystroke for performance
                        };
                    });
                }
            }
        };

        // Initial render when the page loads
        window.onload = renderApp;
    </script>
</body>
</html>

